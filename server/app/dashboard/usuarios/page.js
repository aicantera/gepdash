(()=>{var e={};e.id=543,e.ids=[543],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},5657:(e,r,s)=>{"use strict";s.r(r),s.d(r,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>d});var a=s(7096),t=s(6132),i=s(7284),l=s.n(i),o=s(2564),n={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>o[e]);s.d(r,n);let d=["",{children:["dashboard",{children:["usuarios",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,6941)),"C:\\Users\\joeld\\OneDrive\\Escritorio\\GEP DHASBOARD\\app\\dashboard\\usuarios\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,5581)),"C:\\Users\\joeld\\OneDrive\\Escritorio\\GEP DHASBOARD\\app\\dashboard\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,5345)),"C:\\Users\\joeld\\OneDrive\\Escritorio\\GEP DHASBOARD\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9291,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\joeld\\OneDrive\\Escritorio\\GEP DHASBOARD\\app\\dashboard\\usuarios\\page.tsx"],u="/dashboard/usuarios/page",m={require:s,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:t.x.APP_PAGE,page:"/dashboard/usuarios/page",pathname:"/dashboard/usuarios",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},8690:(e,r,s)=>{Promise.resolve().then(s.bind(s,9477))},9477:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>GestionUsuarios});var a=s(784),t=s(9885),i=s(9708);let l="usuarios";async function obtenerUsuarios(){let{data:e,error:r}=await i.O.from(l).select("*").order("created_at",{ascending:!1});if(r)throw console.error("Error al obtener usuarios:",r),r;return e||[]}async function buscarUsuarios(e){let{data:r,error:s}=await i.O.from(l).select("*").or(`nombre.ilike.%${e}%,email.ilike.%${e}%,empresa.ilike.%${e}%`).order("created_at",{ascending:!1});if(s)throw console.error("Error al buscar usuarios:",s),s;return r||[]}async function obtenerUsuarioPorId(e){let{data:r,error:s}=await i.O.from(l).select("*").eq("id",e).single();if(s)throw console.error("Error al obtener usuario por ID:",s),s;return r}async function crearUsuario(e,r,s,a,t){let{data:o,error:n}=await i.p.auth.admin.createUser({email:r,password:s,email_confirm:!0});if(n)throw console.error("Error al crear usuario en Auth:",n),n;let d=o.user.id,c={auth_id:d,nombre:e,email:r,rol:a,empresa:t||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:u,error:m}=await i.p.from(l).insert([c]).select().single();if(m)throw console.error("Error al crear usuario en la tabla:",m),await i.p.auth.admin.deleteUser(d),m;return u}async function actualizarUsuario(e,r){let s=await obtenerUsuarioPorId(e);if(!s)throw Error("Usuario no encontrado");if(r.email&&r.email!==s.email){let{error:e}=await i.p.auth.admin.updateUserById(s.auth_id,{email:r.email});if(e)throw console.error("Error al actualizar email en Auth:",e),e}let a={...r,updated_at:new Date().toISOString()},{data:t,error:o}=await i.p.from(l).update(a).eq("id",e).select().single();if(o)throw console.error("Error al actualizar usuario en la tabla:",o),o;return t}async function eliminarUsuario(e){let r=await obtenerUsuarioPorId(e);if(!r)throw Error("Usuario no encontrado");let{error:s}=await i.p.from(l).delete().eq("id",e);if(s)throw console.error("Error al eliminar usuario de la tabla:",s),s;let{error:a}=await i.p.auth.admin.deleteUser(r.auth_id);if(a)throw console.error("Error al eliminar usuario de Auth:",a),a}var o=s(3500);function TablaUsuarios({usuarios:e,onEdit:r,onRefresh:s}){let[i,l]=(0,t.useState)(null),[n,d]=(0,t.useState)(!1),[c,u]=(0,t.useState)(null),handleDelete=async e=>{if(i!==e){l(e);return}d(!0),u(null);try{await eliminarUsuario(e),s()}catch(e){u(e.message||"Error al eliminar usuario")}finally{d(!1),l(null)}},cancelDelete=()=>{l(null)};return(0,a.jsxs)("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:[c&&a.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 m-4",children:a.jsx("div",{className:"flex",children:a.jsx("div",{className:"ml-3",children:a.jsx("p",{className:"text-sm text-red-700",children:c})})})}),a.jsx("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Usuario"}),a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rol"}),a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empresa"}),a.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:0===e.length?a.jsx("tr",{children:a.jsx("td",{colSpan:5,className:"px-6 py-4 text-center text-sm text-gray-500",children:"No hay usuarios registrados"})}):e.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("div",{className:"h-10 w-10 flex-shrink-0 bg-gray-200 rounded-full flex items-center justify-center",children:a.jsx("span",{className:"text-gray-500 font-medium",children:e.nombre.substring(0,1).toUpperCase()})}),a.jsx("div",{className:"ml-4",children:a.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.nombre})})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.email}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${"admin"===e.rol?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:"admin"===e.rol?"Administrador":"Viewer"})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.empresa||"-"}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[a.jsx("button",{onClick:()=>r(e),className:"text-indigo-600 hover:text-indigo-900 p-1",title:"Editar usuario",children:a.jsx(o.fmQ,{})}),a.jsx("button",{onClick:()=>handleDelete(e.id),className:`p-1 ${i===e.id?"text-red-600 animate-pulse":"text-gray-500 hover:text-red-600"}`,title:i===e.id?"Confirmar eliminaci\xf3n":"Eliminar usuario",disabled:n,children:a.jsx(o.Xm5,{})}),i===e.id&&a.jsx("button",{onClick:cancelDelete,className:"text-gray-500 hover:text-gray-700 p-1",title:"Cancelar",children:"âœ•"})]})})]},e.id))})]})})]})}function UsuarioModal({usuario:e,isOpen:r,onClose:s,onSuccess:i}){let[l,o]=(0,t.useState)(""),[n,d]=(0,t.useState)(""),[c,u]=(0,t.useState)(""),[m,x]=(0,t.useState)("viewer"),[p,h]=(0,t.useState)(""),[f,b]=(0,t.useState)(!1),[g,y]=(0,t.useState)(null),j=!!e;(0,t.useEffect)(()=>{e?(o(e.nombre||""),d(e.email||""),u(""),x(e.rol||"viewer"),h(e.empresa||"")):(o(""),d(""),u(""),x("viewer"),h(""))},[e]);let handleSubmit=async r=>{r.preventDefault(),b(!0),y(null);try{if(j&&e)await actualizarUsuario(e.id,{nombre:l,email:n,rol:m,empresa:p||void 0});else{if(!c)throw Error("La contrase\xf1a es obligatoria para crear un usuario");await crearUsuario(l,n,c,m,p||void 0)}i(),s()}catch(e){y(e.message||"Ha ocurrido un error")}finally{b(!1)}};return r?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md mx-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-6 border-b",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:j?"Editar Usuario":"A\xf1adir Nuevo Usuario"}),a.jsx("button",{onClick:s,className:"text-gray-500 hover:text-gray-700",children:a.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),g&&a.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mx-6 mt-4",children:a.jsx("div",{className:"flex",children:a.jsx("div",{className:"ml-3",children:a.jsx("p",{className:"text-sm text-red-700",children:g})})})}),(0,a.jsxs)("form",{onSubmit:handleSubmit,className:"p-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"nombre",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre Completo"}),a.jsx("input",{id:"nombre",type:"text",required:!0,value:l,onChange:e=>o(e.target.value),className:"input-field rounded-md shadow-sm w-full",placeholder:"Ingrese nombre completo"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),a.jsx("input",{id:"email",type:"email",required:!0,value:n,onChange:e=>d(e.target.value),className:"input-field rounded-md shadow-sm w-full",placeholder:"correo@ejemplo.com"})]}),!j&&(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Contrase\xf1a"}),a.jsx("input",{id:"password",type:"password",required:!j,value:c,onChange:e=>u(e.target.value),className:"input-field rounded-md shadow-sm w-full",placeholder:"Ingrese contrase\xf1a"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"rol",className:"block text-sm font-medium text-gray-700 mb-1",children:"Rol"}),(0,a.jsxs)("select",{id:"rol",value:m,onChange:e=>x(e.target.value),className:"input-field rounded-md shadow-sm w-full",children:[a.jsx("option",{value:"viewer",children:"Viewer"}),a.jsx("option",{value:"admin",children:"Administrador"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"empresa",className:"block text-sm font-medium text-gray-700 mb-1",children:"Empresa"}),a.jsx("input",{id:"empresa",type:"text",value:p,onChange:e=>h(e.target.value),className:"input-field rounded-md shadow-sm w-full",placeholder:"Seleccione una empresa"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[a.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Cancelar"}),a.jsx("button",{type:"submit",disabled:f,className:"btn-primary px-4 py-2 rounded-md shadow-sm text-sm font-medium",children:f?"Procesando...":j?"Guardar Cambios":"Crear Usuario"})]})]})]})}):null}function GestionUsuarios(){let[e,r]=(0,t.useState)([]),[s,i]=(0,t.useState)(null),[l,n]=(0,t.useState)(!1),[d,c]=(0,t.useState)(!0),[u,m]=(0,t.useState)(null),[x,p]=(0,t.useState)("");(0,t.useEffect)(()=>{cargarUsuarios()},[]);let cargarUsuarios=async()=>{c(!0),m(null);try{let e=await obtenerUsuarios();r(e)}catch(e){m(e.message||"Error al cargar usuarios")}finally{c(!1)}},handleBuscar=async()=>{if(!x.trim()){cargarUsuarios();return}c(!0),m(null);try{let e=await buscarUsuarios(x);r(e)}catch(e){m(e.message||"Error al buscar usuarios")}finally{c(!1)}};return(0,a.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,a.jsxs)("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Gesti\xf3n de Usuarios"}),a.jsx("p",{className:"text-gray-600",children:"Administra usuarios, roles y permisos"})]}),u&&a.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-6",children:a.jsx("div",{className:"flex",children:a.jsx("div",{className:"ml-3",children:a.jsx("p",{className:"text-sm text-red-700",children:u})})})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4 md:mb-0",children:"Todos los Usuarios"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row w-full md:w-auto space-y-3 sm:space-y-0 sm:space-x-3",children:[(0,a.jsxs)("div",{className:"relative flex-grow",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx(o.U41,{className:"h-4 w-4 text-gray-400"})}),a.jsx("input",{type:"text",className:"input-field pl-10 pr-4 py-2 rounded-md w-full",placeholder:"Buscar por nombre, email o empresa",value:x,onChange:e=>p(e.target.value),onKeyPress:e=>{"Enter"===e.key&&handleBuscar()}})]}),a.jsx("button",{onClick:handleBuscar,className:"btn-primary py-2 px-4 rounded-md",children:"Buscar"}),(0,a.jsxs)("button",{onClick:()=>{i(null),n(!0)},className:"btn-primary py-2 px-4 rounded-md flex items-center justify-center",children:[a.jsx(o.wEH,{className:"mr-2"})," A\xf1adir Nuevo Usuario"]})]})]}),d?(0,a.jsxs)("div",{className:"text-center py-8",children:[a.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"}),a.jsx("p",{className:"mt-2 text-gray-500",children:"Cargando usuarios..."})]}):a.jsx(TablaUsuarios,{usuarios:e,onEdit:e=>{i(e),n(!0)},onRefresh:cargarUsuarios})]}),a.jsx(UsuarioModal,{usuario:s,isOpen:l,onClose:()=>{n(!1)},onSuccess:cargarUsuarios})]})}},6941:(e,r,s)=>{"use strict";s.r(r),s.d(r,{$$typeof:()=>l,__esModule:()=>i,default:()=>n});var a=s(5153);let t=(0,a.createProxy)(String.raw`C:\Users\joeld\OneDrive\Escritorio\GEP DHASBOARD\app\dashboard\usuarios\page.tsx`),{__esModule:i,$$typeof:l}=t,o=t.default,n=o}};var r=require("../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),s=r.X(0,[862,322,440,451,500,890,623,39],()=>__webpack_exec__(5657));module.exports=s})();