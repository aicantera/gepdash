(()=>{var e={};e.id=205,e.ids=[205],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},5811:(e,a,r)=>{"use strict";r.r(a),r.d(a,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>d,routeModule:()=>x,tree:()=>c});var t=r(7096),s=r(6132),l=r(7284),i=r.n(l),n=r(2564),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);r.d(a,o);let c=["",{children:["dashboard",{children:["temas",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,6840)),"C:\\Users\\joeld\\OneDrive\\Escritorio\\GEP DHASBOARD\\app\\dashboard\\temas\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,5581)),"C:\\Users\\joeld\\OneDrive\\Escritorio\\GEP DHASBOARD\\app\\dashboard\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,5345)),"C:\\Users\\joeld\\OneDrive\\Escritorio\\GEP DHASBOARD\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9291,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\joeld\\OneDrive\\Escritorio\\GEP DHASBOARD\\app\\dashboard\\temas\\page.tsx"],m="/dashboard/temas/page",u={require:r,loadChunk:()=>Promise.resolve()},x=new t.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/dashboard/temas/page",pathname:"/dashboard/temas",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},6444:(e,a,r)=>{Promise.resolve().then(r.bind(r,2630))},2630:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>TemasPage});var t=r(784),s=r(9885),l=r(9708);let i="temas",n="subtemas";async function obtenerTemas(){let{data:e,error:a}=await l.O.from(i).select("*").order("created_at",{ascending:!1});if(a)throw console.error("Error al obtener temas:",a),a;return e||[]}async function crearTema(e,a,r){let t={nombre_tema:e,desc_tema:a||null,id_usuario:r||null,created_at:new Date().toISOString()},{data:s,error:n}=await l.p.from(i).insert([t]).select().single();if(n)throw console.error("Error al crear tema:",n),n;return s}async function actualizarTema(e,a){let{data:r,error:t}=await l.p.from(i).update(a).eq("id_tema",e).select().single();if(t)throw console.error("Error al actualizar tema:",t),t;return r}async function eliminarTema(e){let{error:a}=await l.p.from(n).delete().eq("id_tema",e);if(a)throw console.error("Error al eliminar subtemas asociados:",a),a;let{error:r}=await l.p.from(i).delete().eq("id_tema",e);if(r)throw console.error("Error al eliminar tema:",r),r}async function obtenerSubtemasPorTema(e){let{data:a,error:r}=await l.O.from(n).select("*").eq("id_tema",e).order("created_at",{ascending:!1});if(r)throw console.error("Error al obtener subtemas:",r),r;return a||[]}async function crearSubtema(e,a,r){let t={id_tema:e,subtema_text:a,subtema_desc:r||null,created_at:new Date().toISOString()},{data:s,error:i}=await l.p.from(n).insert([t]).select().single();if(i)throw console.error("Error al crear subtema:",i),i;return s}async function actualizarSubtema(e,a){let{data:r,error:t}=await l.p.from(n).update(a).eq("id_subtema",e).select().single();if(t)throw console.error("Error al actualizar subtema:",t),t;return r}async function eliminarSubtema(e){let{error:a}=await l.p.from(n).delete().eq("id_subtema",e);if(a)throw console.error("Error al eliminar subtema:",a),a}function TemaModal({isOpen:e,onClose:a,onSuccess:r,temaActual:l}){let[i,n]=(0,s.useState)(""),[o,c]=(0,s.useState)(""),[d,m]=(0,s.useState)(!1),[u,x]=(0,s.useState)(null);(0,s.useEffect)(()=>{e&&(n(l?.nombre_tema||""),c(l?.desc_tema||""),x(null))},[e,l]);let handleSubmit=async e=>{if(e.preventDefault(),!i.trim()){x("El nombre del tema es obligatorio");return}m(!0),x(null);try{l?await actualizarTema(l.id_tema,{nombre_tema:i,desc_tema:o||null}):await crearTema(i,o),r(),a()}catch(e){console.error("Error al guardar tema:",e),x(e.message||"Ha ocurrido un error al guardar el tema")}finally{m(!1)}};return e?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:t.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:(0,t.jsxs)("div",{className:"p-6",children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:l?"Editar Tema":"Nuevo Tema"}),u&&t.jsx("div",{className:"mb-4 p-3 bg-red-50 border-l-4 border-red-500 text-red-700",children:u}),(0,t.jsxs)("form",{onSubmit:handleSubmit,children:[(0,t.jsxs)("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"nombre",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre del Tema *"}),t.jsx("input",{type:"text",id:"nombre",value:i,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el nombre del tema",disabled:d})]}),(0,t.jsxs)("div",{className:"mb-6",children:[t.jsx("label",{htmlFor:"descripcion",className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripci\xf3n"}),t.jsx("textarea",{id:"descripcion",value:o,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese una descripci\xf3n (opcional)",rows:3,disabled:d})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",disabled:d,children:"Cancelar"}),t.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",disabled:d,children:d?"Guardando...":l?"Actualizar":"Crear"})]})]})]})})}):null}function SubtemaModal({isOpen:e,onClose:a,onSuccess:r,subtemaActual:l,temaSeleccionado:i}){let[n,o]=(0,s.useState)(""),[c,d]=(0,s.useState)(""),[m,u]=(0,s.useState)(!1),[x,b]=(0,s.useState)(null),[h,p]=(0,s.useState)([]),[g,f]=(0,s.useState)(null),[y,j]=(0,s.useState)(!1);(0,s.useEffect)(()=>{e&&cargarTemas()},[e]),(0,s.useEffect)(()=>{e&&(o(l?.subtema_text||""),d(l?.subtema_desc||""),f(l?.id_tema||i?.id_tema||null),b(null))},[e,l,i]);let cargarTemas=async()=>{j(!0);try{let e=await obtenerTemas();p(e)}catch(e){console.error("Error al cargar temas:",e),b("Error al cargar los temas disponibles")}finally{j(!1)}},handleSubmit=async e=>{if(e.preventDefault(),!n.trim()){b("El texto del subtema es obligatorio");return}if(!g){b("Debe seleccionar un tema principal");return}u(!0),b(null);try{l?await actualizarSubtema(l.id_subtema,{id_tema:g,subtema_text:n,subtema_desc:c||null}):await crearSubtema(g,n,c),r(),a()}catch(e){console.error("Error al guardar subtema:",e),b(e.message||"Ha ocurrido un error al guardar el subtema")}finally{u(!1)}};return e?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:t.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:(0,t.jsxs)("div",{className:"p-6",children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:l?"Editar Subtema":"Nuevo Subtema"}),x&&t.jsx("div",{className:"mb-4 p-3 bg-red-50 border-l-4 border-red-500 text-red-700",children:x}),(0,t.jsxs)("form",{onSubmit:handleSubmit,children:[(0,t.jsxs)("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"tema",className:"block text-sm font-medium text-gray-700 mb-1",children:"Tema Principal *"}),(0,t.jsxs)("select",{id:"tema",value:g||"",onChange:e=>f(e.target.value?parseInt(e.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:m||y,required:!0,children:[t.jsx("option",{value:"",children:"Seleccione un tema"}),h.map(e=>t.jsx("option",{value:e.id_tema,children:e.nombre_tema},e.id_tema))]}),y&&t.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Cargando temas..."})]}),(0,t.jsxs)("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"texto",className:"block text-sm font-medium text-gray-700 mb-1",children:"Texto del Subtema *"}),t.jsx("input",{type:"text",id:"texto",value:n,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el texto del subtema",disabled:m,required:!0})]}),(0,t.jsxs)("div",{className:"mb-6",children:[t.jsx("label",{htmlFor:"descripcion",className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripci\xf3n"}),t.jsx("textarea",{id:"descripcion",value:c,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese una descripci\xf3n (opcional)",rows:3,disabled:m})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",disabled:m,children:"Cancelar"}),t.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",disabled:m||!g,children:m?"Guardando...":l?"Actualizar":"Crear"})]})]})]})})}):null}var o=r(3500);function GestionTemas(){let[e,a]=(0,s.useState)([]),[r,l]=(0,s.useState)(null),[i,n]=(0,s.useState)(null),[c,d]=(0,s.useState)(!1),[m,u]=(0,s.useState)(null),[x,b]=(0,s.useState)([]),[h,p]=(0,s.useState)(null),[g,f]=(0,s.useState)(!1),[y,j]=(0,s.useState)(null),[v,N]=(0,s.useState)(!1),[_,S]=(0,s.useState)(null);(0,s.useEffect)(()=>{cargarTemas()},[]),(0,s.useEffect)(()=>{r?cargarSubtemas(r.id_tema):b([])},[r]);let cargarTemas=async()=>{N(!0),S(null);try{let e=await obtenerTemas();a(e),e.length>0&&!r&&l(e[0])}catch(e){console.error("Error al cargar temas:",e),S("Error al cargar los temas: "+(e.message||"Error desconocido"))}finally{N(!1)}},cargarSubtemas=async e=>{N(!0);try{let a=await obtenerSubtemasPorTema(e);b(a)}catch(e){console.error("Error al cargar subtemas:",e),S("Error al cargar los subtemas: "+(e.message||"Error desconocido"))}finally{N(!1)}},handleEditarTema=e=>{n(e),d(!0)},handleEliminarTema=async e=>{if(m!==e){u(e);return}N(!0),S(null);try{await eliminarTema(e),r&&r.id_tema===e&&l(null),cargarTemas()}catch(e){console.error("Error al eliminar tema:",e),S("Error al eliminar el tema: "+(e.message||"Error desconocido"))}finally{N(!1),u(null)}},handleEditarSubtema=e=>{p(e),f(!0)},handleEliminarSubtema=async e=>{if(y!==e){j(e);return}N(!0),S(null);try{await eliminarSubtema(e),r&&cargarSubtemas(r.id_tema)}catch(e){console.error("Error al eliminar subtema:",e),S("Error al eliminar el subtema: "+(e.message||"Error desconocido"))}finally{N(!1),j(null)}},handleSeleccionarTema=e=>{l(e)};return(0,t.jsxs)("div",{className:"container mx-auto p-4",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Gesti\xf3n de Temas y Subtemas"}),_&&t.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-4",children:t.jsx("div",{className:"flex",children:t.jsx("div",{className:"ml-3",children:t.jsx("p",{className:"text-sm text-red-700",children:_})})})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,t.jsxs)("div",{className:"p-4 bg-gray-50 border-b flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[t.jsx("h2",{className:"text-lg font-medium text-gray-700",children:"Temas Principales"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Administra los temas principales de clasificaci\xf3n"})]}),t.jsx("button",{onClick:()=>{n(null),d(!0)},className:"bg-blue-600 text-white p-2 rounded-full hover:bg-blue-700 focus:outline-none",disabled:v,children:t.jsx(o.wEH,{})})]}),(0,t.jsxs)("div",{className:"bg-blue-100 text-blue-800 px-4 py-2 font-medium",children:[e.length," temas encontrados"]}),0===e.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[t.jsx(o.$nz,{className:"mx-auto text-gray-400 text-5xl mb-4"}),t.jsx("p",{className:"text-gray-500",children:"No hay temas registrados"})]}):t.jsx("ul",{className:"divide-y divide-gray-200",children:e.map(e=>t.jsx("li",{className:`p-4 hover:bg-gray-50 cursor-pointer ${r?.id_tema===e.id_tema?"bg-blue-50":""}`,onClick:()=>handleSeleccionarTema(e),children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[t.jsx("h3",{className:"font-medium text-gray-800",children:e.nombre_tema}),e.desc_tema&&t.jsx("p",{className:"text-sm text-gray-500 mt-1",children:e.desc_tema})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[t.jsx("button",{onClick:a=>{a.stopPropagation(),handleEditarTema(e)},className:"text-blue-600 hover:text-blue-800 p-1",disabled:v,children:t.jsx(o.fmQ,{})}),t.jsx("button",{onClick:a=>{a.stopPropagation(),handleEliminarTema(e.id_tema)},className:`p-1 ${m===e.id_tema?"text-red-600 bg-red-100 rounded":"text-red-500 hover:text-red-700"}`,disabled:v,children:t.jsx(o.Xm5,{})})]})]})},e.id_tema))})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,t.jsxs)("div",{className:"p-4 bg-gray-50 border-b flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[t.jsx("h2",{className:"text-lg font-medium text-gray-700",children:"Subtemas"}),t.jsx("p",{className:"text-sm text-gray-500",children:r?`Subtemas asociados a: ${r.nombre_tema}`:"Seleccione un tema principal para ver sus subtemas"})]}),t.jsx("button",{onClick:()=>{p(null),f(!0)},className:"bg-blue-600 text-white p-2 rounded-full hover:bg-blue-700 focus:outline-none",disabled:v||!r,children:t.jsx(o.wEH,{})})]}),(0,t.jsxs)("div",{className:"bg-blue-100 text-blue-800 px-4 py-2 font-medium",children:[x.length," subtemas encontrados"]}),r?0===x.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[t.jsx(o.mGS,{className:"mx-auto text-gray-400 text-5xl mb-4"}),t.jsx("p",{className:"text-gray-500",children:"No hay subtemas para este tema"})]}):t.jsx("ul",{className:"divide-y divide-gray-200",children:x.map(e=>t.jsx("li",{className:"p-4 hover:bg-gray-50",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[t.jsx("h3",{className:"font-medium text-gray-800",children:e.subtema_text}),e.subtema_desc&&t.jsx("p",{className:"text-sm text-gray-500 mt-1",children:e.subtema_desc})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[t.jsx("button",{onClick:()=>handleEditarSubtema(e),className:"text-blue-600 hover:text-blue-800 p-1",disabled:v,children:t.jsx(o.fmQ,{})}),t.jsx("button",{onClick:()=>handleEliminarSubtema(e.id_subtema),className:`p-1 ${y===e.id_subtema?"text-red-600 bg-red-100 rounded":"text-red-500 hover:text-red-700"}`,disabled:v,children:t.jsx(o.Xm5,{})})]})]})},e.id_subtema))}):(0,t.jsxs)("div",{className:"text-center py-8",children:[t.jsx(o.$nz,{className:"mx-auto text-gray-400 text-5xl mb-4"}),t.jsx("p",{className:"text-gray-500",children:"Seleccione un tema principal"})]})]})]}),t.jsx(TemaModal,{isOpen:c,onClose:()=>d(!1),onSuccess:()=>{cargarTemas()},temaActual:i}),t.jsx(SubtemaModal,{isOpen:g,onClose:()=>f(!1),onSuccess:()=>{r&&cargarSubtemas(r.id_tema)},subtemaActual:h,temaSeleccionado:r})]})}function TemasPage(){let[e,a]=(0,s.useState)(!0),[r,l]=(0,s.useState)(null);return((0,s.useEffect)(()=>{let cargarDatos=async()=>{try{await obtenerTemas(),a(!1)}catch(e){console.error("Error al cargar datos iniciales:",e),l("Error al cargar datos: "+(e.message||"Error desconocido")),a(!1)}};cargarDatos()},[]),e)?t.jsx("div",{className:"flex justify-center items-center h-screen",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):r?t.jsx("div",{className:"container mx-auto p-4",children:t.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-4",children:t.jsx("div",{className:"flex",children:(0,t.jsxs)("div",{className:"ml-3",children:[t.jsx("p",{className:"text-sm text-red-700",children:r}),t.jsx("p",{className:"text-sm text-red-700 mt-2",children:"Por favor, verifica tu conexi\xf3n a internet y recarga la p\xe1gina."})]})})})}):t.jsx(GestionTemas,{})}},6840:(e,a,r)=>{"use strict";r.r(a),r.d(a,{$$typeof:()=>i,__esModule:()=>l,default:()=>o});var t=r(5153);let s=(0,t.createProxy)(String.raw`C:\Users\joeld\OneDrive\Escritorio\GEP DHASBOARD\app\dashboard\temas\page.tsx`),{__esModule:l,$$typeof:i}=s,n=s.default,o=n}};var a=require("../../../webpack-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),r=a.X(0,[862,322,440,451,500,890,623,39],()=>__webpack_exec__(5811));module.exports=r})();