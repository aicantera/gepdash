(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[136],{2697:function(e,s,r){Promise.resolve().then(r.bind(r,3453))},3453:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return GestionEmpresas}});var t=r(7437),a=r(2265),l=r(2899);let i="empresas";async function obtenerEmpresas(){let{data:e,error:s}=await l.O.from(i).select("*").order("created_at",{ascending:!1});if(s)throw console.error("Error al obtener empresas:",s),s;return e||[]}async function buscarEmpresas(e){let{data:s,error:r}=await l.O.from(i).select("*").or("nombre_empr.ilike.%".concat(e,"%,rfc.ilike.%").concat(e,"%,giro.ilike.%").concat(e,"%")).order("created_at",{ascending:!1});if(r)throw console.error("Error al buscar empresas:",r),r;return s||[]}async function crearEmpresa(e,s,r,t,a){let n={nombre_empr:e,rfc:s,giro:r,id_usuario:t||null,sitio_web:a||null,created_at:new Date().toISOString()},{data:c,error:m}=await l.p.from(i).insert([n]).select().single();if(m)throw console.error("Error al crear empresa:",m),m;return c}async function actualizarEmpresa(e,s){let{data:r,error:t}=await l.p.from(i).update(s).eq("id_empresa",e).select().single();if(t)throw console.error("Error al actualizar empresa:",t),t;return r}async function eliminarEmpresa(e){let{error:s}=await l.p.from(i).delete().eq("id_empresa",e);if(s)throw console.error("Error al eliminar empresa:",s),s}var n=r(3159);function TablaEmpresas(e){let{empresas:s,onEdit:r,onRefresh:l}=e,[i,c]=(0,a.useState)(null),[m,d]=(0,a.useState)(!1),[o,u]=(0,a.useState)(null),handleDelete=async e=>{if(i!==e){c(e);return}d(!0),u(null);try{await eliminarEmpresa(e),l()}catch(e){u(e.message||"Error al eliminar empresa")}finally{d(!1),c(null)}},cancelDelete=()=>{c(null)};return(0,t.jsxs)("div",{children:[o&&(0,t.jsx)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-4",children:(0,t.jsx)("div",{className:"flex",children:(0,t.jsx)("div",{className:"ml-3",children:(0,t.jsx)("p",{className:"text-sm text-red-700",children:o})})})}),(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)("div",{className:"flex justify-between items-center",children:(0,t.jsxs)("div",{className:"bg-blue-100 text-blue-800 px-4 py-2 rounded-md font-medium",children:[s.length," empresas encontradas"]})})}),0===s.length?(0,t.jsxs)("div",{className:"text-center py-8 bg-white rounded-lg shadow-md",children:[(0,t.jsx)(n.m17,{className:"mx-auto text-gray-400 text-5xl mb-4"}),(0,t.jsx)("p",{className:"text-gray-500",children:"No hay empresas registradas"})]}):(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(e=>(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300",children:[(0,t.jsx)("div",{className:"p-5 border-b border-gray-100",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"h-12 w-12 flex-shrink-0 bg-blue-100 rounded-full flex items-center justify-center mr-4",children:(0,t.jsx)("span",{className:"text-blue-600 font-medium text-xl",children:e.nombre_empr?e.nombre_empr.substring(0,1).toUpperCase():"?"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:e.nombre_empr||"Sin nombre"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:e.giro||"Sin giro"})]})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)("button",{onClick:()=>r(e),className:"text-indigo-600 hover:text-indigo-900 p-1",title:"Editar empresa",children:(0,t.jsx)(n.fmQ,{})}),(0,t.jsx)("button",{onClick:()=>handleDelete(e.id_empresa),className:"p-1 ".concat(i===e.id_empresa?"text-red-600 animate-pulse":"text-gray-500 hover:text-red-600"),title:i===e.id_empresa?"Confirmar eliminaci\xf3n":"Eliminar empresa",disabled:m,children:(0,t.jsx)(n.Xm5,{})}),i===e.id_empresa&&(0,t.jsx)("button",{onClick:cancelDelete,className:"text-gray-500 hover:text-gray-700 p-1",title:"Cancelar",children:"✕"})]})]})}),(0,t.jsx)("div",{className:"px-5 py-3 bg-gray-50",children:(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"RFC"}),(0,t.jsx)("p",{className:"text-sm font-medium",children:e.rfc||"-"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Sitio Web"}),e.sitio_web?(0,t.jsxs)("a",{href:e.sitio_web.startsWith("http")?e.sitio_web:"https://".concat(e.sitio_web),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 text-sm flex items-center",children:[(0,t.jsx)(n.ssk,{className:"mr-1"})," Visitar"]}):(0,t.jsx)("p",{className:"text-sm",children:"-"})]})]})}),(0,t.jsxs)("div",{className:"px-5 py-3 border-t border-gray-100 flex justify-between text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center text-blue-600",children:[(0,t.jsx)(n.mGS,{className:"mr-1"}),(0,t.jsx)("span",{children:"Alertas: 0"})]}),(0,t.jsxs)("div",{className:"flex items-center text-green-600",children:[(0,t.jsx)(n.I$,{className:"mr-1"}),(0,t.jsx)("span",{children:"Contactos: 0"})]}),(0,t.jsx)("button",{className:"text-red-500 hover:text-red-700 text-sm font-medium",children:"Eliminar"})]})]},e.id_empresa))})]})}function EmpresaModal(e){let{isOpen:s,onClose:r,onSuccess:l,empresaSeleccionada:i}=e,[c,m]=(0,a.useState)(""),[d,o]=(0,a.useState)(""),[u,x]=(0,a.useState)(""),[p,h]=(0,a.useState)(""),[b,f]=(0,a.useState)(!1),[g,j]=(0,a.useState)(null);(0,a.useEffect)(()=>{i?(m(i.nombre_empr),o(i.rfc),x(i.giro),h(i.sitio_web||"")):(m(""),o(""),x(""),h("")),j(null)},[i,s]);let handleSubmit=async e=>{if(e.preventDefault(),!c||!d||!u){j("Por favor complete los campos obligatorios");return}f(!0),j(null);try{i?await actualizarEmpresa(i.id_empresa,{nombre_empr:c,rfc:d,giro:u,sitio_web:p||null}):await crearEmpresa(c,d,u,null,p||null),l(),r()}catch(e){j(e.message||"Error al guardar la empresa")}finally{f(!1)}};return s?(0,t.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,t.jsxs)("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[(0,t.jsx)("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:(0,t.jsx)("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),(0,t.jsx)("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),(0,t.jsx)("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:(0,t.jsxs)("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:i?"Editar Empresa":"A\xf1adir Nueva Empresa"}),(0,t.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-500",children:(0,t.jsx)(n.aHS,{})})]}),g&&(0,t.jsx)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-4",children:(0,t.jsx)("div",{className:"flex",children:(0,t.jsx)("div",{className:"ml-3",children:(0,t.jsx)("p",{className:"text-sm text-red-700",children:g})})})}),(0,t.jsxs)("form",{onSubmit:handleSubmit,children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"nombre",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre de la Empresa *"}),(0,t.jsx)("input",{id:"nombre",type:"text",value:c,onChange:e=>m(e.target.value),className:"input-field rounded-md shadow-sm w-full",placeholder:"Nombre de la empresa",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"rfc",className:"block text-sm font-medium text-gray-700 mb-1",children:"RFC *"}),(0,t.jsx)("input",{id:"rfc",type:"text",value:d,onChange:e=>o(e.target.value),className:"input-field rounded-md shadow-sm w-full",placeholder:"RFC de la empresa",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"giro",className:"block text-sm font-medium text-gray-700 mb-1",children:"Giro *"}),(0,t.jsx)("input",{id:"giro",type:"text",value:u,onChange:e=>x(e.target.value),className:"input-field rounded-md shadow-sm w-full",placeholder:"Giro de la empresa",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"sitioWeb",className:"block text-sm font-medium text-gray-700 mb-1",children:"Sitio Web"}),(0,t.jsx)("input",{id:"sitioWeb",type:"url",value:p,onChange:e=>h(e.target.value),className:"input-field rounded-md shadow-sm w-full",placeholder:"https://www.ejemplo.com"})]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,t.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",disabled:b,className:"btn-primary px-4 py-2 rounded-md shadow-sm text-sm font-medium",children:b?"Guardando...":i?"Actualizar":"Guardar"})]})]})]})})]})}):null}function GestionEmpresas(){let[e,s]=(0,a.useState)([]),[r,l]=(0,a.useState)(null),[i,c]=(0,a.useState)(!1),[m,d]=(0,a.useState)(!0),[o,u]=(0,a.useState)(null),[x,p]=(0,a.useState)("");(0,a.useEffect)(()=>{cargarEmpresas()},[]);let cargarEmpresas=async()=>{d(!0),u(null);try{let e=await obtenerEmpresas();s(e)}catch(e){u(e.message||"Error al cargar empresas")}finally{d(!1)}},handleBuscar=async()=>{if(!x.trim()){cargarEmpresas();return}d(!0),u(null);try{let e=await buscarEmpresas(x);s(e)}catch(e){u(e.message||"Error al buscar empresas")}finally{d(!1)}};return(0,t.jsxs)("div",{className:"container mx-auto px-4",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-4 md:mb-0",children:"Gesti\xf3n de Empresas"}),(0,t.jsxs)("button",{onClick:()=>{l(null),c(!0)},className:"btn-primary flex items-center",children:[(0,t.jsx)(n.wEH,{className:"mr-2"})," A\xf1adir Nueva Empresa"]})]}),(0,t.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-md mb-6",children:(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,t.jsxs)("div",{className:"flex-grow relative",children:[(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,t.jsx)(n.U41,{className:"text-gray-400"})}),(0,t.jsx)("input",{type:"text",placeholder:"Buscar por nombre, RFC o giro...",className:"pl-10 pr-4 py-2 border rounded-md w-full",value:x,onChange:e=>p(e.target.value),onKeyDown:e=>{"Enter"===e.key&&handleBuscar()}})]}),(0,t.jsx)("button",{onClick:handleBuscar,className:"btn-secondary",children:"Buscar"})]})}),o&&(0,t.jsx)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-6",children:(0,t.jsx)("div",{className:"flex",children:(0,t.jsx)("div",{className:"ml-3",children:(0,t.jsx)("p",{className:"text-sm text-red-700",children:o})})})}),m?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"}),(0,t.jsx)("p",{className:"mt-2 text-gray-500",children:"Cargando empresas..."})]}):(0,t.jsx)(TablaEmpresas,{empresas:e,onEdit:e=>{l(e),c(!0)},onRefresh:cargarEmpresas}),(0,t.jsx)(EmpresaModal,{isOpen:i,onClose:()=>{c(!1)},onSuccess:cargarEmpresas,empresaSeleccionada:r})]})}},2899:function(e,s,r){"use strict";r.d(s,{O:function(){return l},p:function(){return i}});var t=r(4756);let a="https://masterd.gepdigital.ai",l=(0,t.eI)(a,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE"),i=(0,t.eI)(a,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJzZXJ2aWNlX3JvbGUiLAogICAgImlzcyI6ICJzdXBhYmFzZS1kZW1vIiwKICAgICJpYXQiOiAxNjQxNzY5MjAwLAogICAgImV4cCI6IDE3OTk1MzU2MDAKfQ.DaYlNEoUrrEn2Ig7tqibS-PHK5vgusbcbo7X36XVt4Q")},1172:function(e,s,r){"use strict";r.d(s,{w_:function(){return GenIcon}});var t=r(2265),a={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},l=t.createContext&&t.createContext(a),__assign=function(){return(__assign=Object.assign||function(e){for(var s,r=1,t=arguments.length;r<t;r++)for(var a in s=arguments[r])Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a]);return e}).apply(this,arguments)},__rest=function(e,s){var r={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&0>s.indexOf(t)&&(r[t]=e[t]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,t=Object.getOwnPropertySymbols(e);a<t.length;a++)0>s.indexOf(t[a])&&Object.prototype.propertyIsEnumerable.call(e,t[a])&&(r[t[a]]=e[t[a]]);return r};function Tree2Element(e){return e&&e.map(function(e,s){return t.createElement(e.tag,__assign({key:s},e.attr),Tree2Element(e.child))})}function GenIcon(e){return function(s){return t.createElement(IconBase,__assign({attr:__assign({},e.attr)},s),Tree2Element(e.child))}}function IconBase(e){var elem=function(s){var r,a=e.attr,l=e.size,i=e.title,n=__rest(e,["attr","size","title"]),c=l||s.size||"1em";return s.className&&(r=s.className),e.className&&(r=(r?r+" ":"")+e.className),t.createElement("svg",__assign({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,a,n,{className:r,style:__assign(__assign({color:e.color||s.color},s.style),e.style),height:c,width:c,xmlns:"http://www.w3.org/2000/svg"}),i&&t.createElement("title",null,i),e.children)};return void 0!==l?t.createElement(l.Consumer,null,function(e){return elem(e)}):elem(a)}}},function(e){e.O(0,[420,36,971,472,744],function(){return e(e.s=2697)}),_N_E=e.O()}]);