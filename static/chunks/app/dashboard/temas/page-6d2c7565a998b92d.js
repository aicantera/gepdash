(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[205],{3952:function(e,a,t){Promise.resolve().then(t.bind(t,9645))},9645:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return TemasPage}});var r=t(7437),s=t(2265),l=t(2899);let n="temas",i="subtemas";async function obtenerTemas(){let{data:e,error:a}=await l.O.from(n).select("*").order("created_at",{ascending:!1});if(a)throw console.error("Error al obtener temas:",a),a;return e||[]}async function crearTema(e,a,t){let r={nombre_tema:e,desc_tema:a||null,id_usuario:t||null,created_at:new Date().toISOString()},{data:s,error:i}=await l.p.from(n).insert([r]).select().single();if(i)throw console.error("Error al crear tema:",i),i;return s}async function actualizarTema(e,a){let{data:t,error:r}=await l.p.from(n).update(a).eq("id_tema",e).select().single();if(r)throw console.error("Error al actualizar tema:",r),r;return t}async function eliminarTema(e){let{error:a}=await l.p.from(i).delete().eq("id_tema",e);if(a)throw console.error("Error al eliminar subtemas asociados:",a),a;let{error:t}=await l.p.from(n).delete().eq("id_tema",e);if(t)throw console.error("Error al eliminar tema:",t),t}async function obtenerSubtemasPorTema(e){let{data:a,error:t}=await l.O.from(i).select("*").eq("id_tema",e).order("created_at",{ascending:!1});if(t)throw console.error("Error al obtener subtemas:",t),t;return a||[]}async function crearSubtema(e,a,t){let r={id_tema:e,subtema_text:a,subtema_desc:t||null,created_at:new Date().toISOString()},{data:s,error:n}=await l.p.from(i).insert([r]).select().single();if(n)throw console.error("Error al crear subtema:",n),n;return s}async function actualizarSubtema(e,a){let{data:t,error:r}=await l.p.from(i).update(a).eq("id_subtema",e).select().single();if(r)throw console.error("Error al actualizar subtema:",r),r;return t}async function eliminarSubtema(e){let{error:a}=await l.p.from(i).delete().eq("id_subtema",e);if(a)throw console.error("Error al eliminar subtema:",a),a}function TemaModal(e){let{isOpen:a,onClose:t,onSuccess:l,temaActual:n}=e,[i,c]=(0,s.useState)(""),[o,d]=(0,s.useState)(""),[m,u]=(0,s.useState)(!1),[b,x]=(0,s.useState)(null);(0,s.useEffect)(()=>{a&&(c((null==n?void 0:n.nombre_tema)||""),d((null==n?void 0:n.desc_tema)||""),x(null))},[a,n]);let handleSubmit=async e=>{if(e.preventDefault(),!i.trim()){x("El nombre del tema es obligatorio");return}u(!0),x(null);try{n?await actualizarTema(n.id_tema,{nombre_tema:i,desc_tema:o||null}):await crearTema(i,o),l(),t()}catch(e){console.error("Error al guardar tema:",e),x(e.message||"Ha ocurrido un error al guardar el tema")}finally{u(!1)}};return a?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:n?"Editar Tema":"Nuevo Tema"}),b&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-red-50 border-l-4 border-red-500 text-red-700",children:b}),(0,r.jsxs)("form",{onSubmit:handleSubmit,children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"nombre",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre del Tema *"}),(0,r.jsx)("input",{type:"text",id:"nombre",value:i,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el nombre del tema",disabled:m})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{htmlFor:"descripcion",className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripci\xf3n"}),(0,r.jsx)("textarea",{id:"descripcion",value:o,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese una descripci\xf3n (opcional)",rows:3,disabled:m})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",disabled:m,children:"Cancelar"}),(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",disabled:m,children:m?"Guardando...":n?"Actualizar":"Crear"})]})]})]})})}):null}function SubtemaModal(e){let{isOpen:a,onClose:t,onSuccess:l,subtemaActual:n,temaSeleccionado:i}=e,[c,o]=(0,s.useState)(""),[d,m]=(0,s.useState)(""),[u,b]=(0,s.useState)(!1),[x,g]=(0,s.useState)(null),[h,f]=(0,s.useState)([]),[p,y]=(0,s.useState)(null),[j,v]=(0,s.useState)(!1);(0,s.useEffect)(()=>{a&&cargarTemas()},[a]),(0,s.useEffect)(()=>{a&&(o((null==n?void 0:n.subtema_text)||""),m((null==n?void 0:n.subtema_desc)||""),y((null==n?void 0:n.id_tema)||(null==i?void 0:i.id_tema)||null),g(null))},[a,n,i]);let cargarTemas=async()=>{v(!0);try{let e=await obtenerTemas();f(e)}catch(e){console.error("Error al cargar temas:",e),g("Error al cargar los temas disponibles")}finally{v(!1)}},handleSubmit=async e=>{if(e.preventDefault(),!c.trim()){g("El texto del subtema es obligatorio");return}if(!p){g("Debe seleccionar un tema principal");return}b(!0),g(null);try{n?await actualizarSubtema(n.id_subtema,{id_tema:p,subtema_text:c,subtema_desc:d||null}):await crearSubtema(p,c,d),l(),t()}catch(e){console.error("Error al guardar subtema:",e),g(e.message||"Ha ocurrido un error al guardar el subtema")}finally{b(!1)}};return a?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:n?"Editar Subtema":"Nuevo Subtema"}),x&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-red-50 border-l-4 border-red-500 text-red-700",children:x}),(0,r.jsxs)("form",{onSubmit:handleSubmit,children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"tema",className:"block text-sm font-medium text-gray-700 mb-1",children:"Tema Principal *"}),(0,r.jsxs)("select",{id:"tema",value:p||"",onChange:e=>y(e.target.value?parseInt(e.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:u||j,required:!0,children:[(0,r.jsx)("option",{value:"",children:"Seleccione un tema"}),h.map(e=>(0,r.jsx)("option",{value:e.id_tema,children:e.nombre_tema},e.id_tema))]}),j&&(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Cargando temas..."})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"texto",className:"block text-sm font-medium text-gray-700 mb-1",children:"Texto del Subtema *"}),(0,r.jsx)("input",{type:"text",id:"texto",value:c,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el texto del subtema",disabled:u,required:!0})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{htmlFor:"descripcion",className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripci\xf3n"}),(0,r.jsx)("textarea",{id:"descripcion",value:d,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese una descripci\xf3n (opcional)",rows:3,disabled:u})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",disabled:u,children:"Cancelar"}),(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",disabled:u||!p,children:u?"Guardando...":n?"Actualizar":"Crear"})]})]})]})})}):null}var c=t(3159);function GestionTemas(){let[e,a]=(0,s.useState)([]),[t,l]=(0,s.useState)(null),[n,i]=(0,s.useState)(null),[o,d]=(0,s.useState)(!1),[m,u]=(0,s.useState)(null),[b,x]=(0,s.useState)([]),[g,h]=(0,s.useState)(null),[f,p]=(0,s.useState)(!1),[y,j]=(0,s.useState)(null),[v,N]=(0,s.useState)(!1),[w,_]=(0,s.useState)(null);(0,s.useEffect)(()=>{cargarTemas()},[]),(0,s.useEffect)(()=>{t?cargarSubtemas(t.id_tema):x([])},[t]);let cargarTemas=async()=>{N(!0),_(null);try{let e=await obtenerTemas();a(e),e.length>0&&!t&&l(e[0])}catch(e){console.error("Error al cargar temas:",e),_("Error al cargar los temas: "+(e.message||"Error desconocido"))}finally{N(!1)}},cargarSubtemas=async e=>{N(!0);try{let a=await obtenerSubtemasPorTema(e);x(a)}catch(e){console.error("Error al cargar subtemas:",e),_("Error al cargar los subtemas: "+(e.message||"Error desconocido"))}finally{N(!1)}},handleEditarTema=e=>{i(e),d(!0)},handleEliminarTema=async e=>{if(m!==e){u(e);return}N(!0),_(null);try{await eliminarTema(e),t&&t.id_tema===e&&l(null),cargarTemas()}catch(e){console.error("Error al eliminar tema:",e),_("Error al eliminar el tema: "+(e.message||"Error desconocido"))}finally{N(!1),u(null)}},handleEditarSubtema=e=>{h(e),p(!0)},handleEliminarSubtema=async e=>{if(y!==e){j(e);return}N(!0),_(null);try{await eliminarSubtema(e),t&&cargarSubtemas(t.id_tema)}catch(e){console.error("Error al eliminar subtema:",e),_("Error al eliminar el subtema: "+(e.message||"Error desconocido"))}finally{N(!1),j(null)}},handleSeleccionarTema=e=>{l(e)};return(0,r.jsxs)("div",{className:"container mx-auto p-4",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Gesti\xf3n de Temas y Subtemas"}),w&&(0,r.jsx)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-4",children:(0,r.jsx)("div",{className:"flex",children:(0,r.jsx)("div",{className:"ml-3",children:(0,r.jsx)("p",{className:"text-sm text-red-700",children:w})})})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-4 bg-gray-50 border-b flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-700",children:"Temas Principales"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Administra los temas principales de clasificaci\xf3n"})]}),(0,r.jsx)("button",{onClick:()=>{i(null),d(!0)},className:"bg-blue-600 text-white p-2 rounded-full hover:bg-blue-700 focus:outline-none",disabled:v,children:(0,r.jsx)(c.wEH,{})})]}),(0,r.jsxs)("div",{className:"bg-blue-100 text-blue-800 px-4 py-2 font-medium",children:[e.length," temas encontrados"]}),0===e.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(c.$nz,{className:"mx-auto text-gray-400 text-5xl mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"No hay temas registrados"})]}):(0,r.jsx)("ul",{className:"divide-y divide-gray-200",children:e.map(e=>(0,r.jsx)("li",{className:"p-4 hover:bg-gray-50 cursor-pointer ".concat((null==t?void 0:t.id_tema)===e.id_tema?"bg-blue-50":""),onClick:()=>handleSeleccionarTema(e),children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-800",children:e.nombre_tema}),e.desc_tema&&(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:e.desc_tema})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:a=>{a.stopPropagation(),handleEditarTema(e)},className:"text-blue-600 hover:text-blue-800 p-1",disabled:v,children:(0,r.jsx)(c.fmQ,{})}),(0,r.jsx)("button",{onClick:a=>{a.stopPropagation(),handleEliminarTema(e.id_tema)},className:"p-1 ".concat(m===e.id_tema?"text-red-600 bg-red-100 rounded":"text-red-500 hover:text-red-700"),disabled:v,children:(0,r.jsx)(c.Xm5,{})})]})]})},e.id_tema))})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-4 bg-gray-50 border-b flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-700",children:"Subtemas"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:t?"Subtemas asociados a: ".concat(t.nombre_tema):"Seleccione un tema principal para ver sus subtemas"})]}),(0,r.jsx)("button",{onClick:()=>{h(null),p(!0)},className:"bg-blue-600 text-white p-2 rounded-full hover:bg-blue-700 focus:outline-none",disabled:v||!t,children:(0,r.jsx)(c.wEH,{})})]}),(0,r.jsxs)("div",{className:"bg-blue-100 text-blue-800 px-4 py-2 font-medium",children:[b.length," subtemas encontrados"]}),t?0===b.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(c.mGS,{className:"mx-auto text-gray-400 text-5xl mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"No hay subtemas para este tema"})]}):(0,r.jsx)("ul",{className:"divide-y divide-gray-200",children:b.map(e=>(0,r.jsx)("li",{className:"p-4 hover:bg-gray-50",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-800",children:e.subtema_text}),e.subtema_desc&&(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:e.subtema_desc})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:()=>handleEditarSubtema(e),className:"text-blue-600 hover:text-blue-800 p-1",disabled:v,children:(0,r.jsx)(c.fmQ,{})}),(0,r.jsx)("button",{onClick:()=>handleEliminarSubtema(e.id_subtema),className:"p-1 ".concat(y===e.id_subtema?"text-red-600 bg-red-100 rounded":"text-red-500 hover:text-red-700"),disabled:v,children:(0,r.jsx)(c.Xm5,{})})]})]})},e.id_subtema))}):(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(c.$nz,{className:"mx-auto text-gray-400 text-5xl mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"Seleccione un tema principal"})]})]})]}),(0,r.jsx)(TemaModal,{isOpen:o,onClose:()=>d(!1),onSuccess:()=>{cargarTemas()},temaActual:n}),(0,r.jsx)(SubtemaModal,{isOpen:f,onClose:()=>p(!1),onSuccess:()=>{t&&cargarSubtemas(t.id_tema)},subtemaActual:g,temaSeleccionado:t})]})}function TemasPage(){let[e,a]=(0,s.useState)(!0),[t,l]=(0,s.useState)(null);return((0,s.useEffect)(()=>{let cargarDatos=async()=>{try{await obtenerTemas(),a(!1)}catch(e){console.error("Error al cargar datos iniciales:",e),l("Error al cargar datos: "+(e.message||"Error desconocido")),a(!1)}};cargarDatos()},[]),e)?(0,r.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):t?(0,r.jsx)("div",{className:"container mx-auto p-4",children:(0,r.jsx)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-4",children:(0,r.jsx)("div",{className:"flex",children:(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("p",{className:"text-sm text-red-700",children:t}),(0,r.jsx)("p",{className:"text-sm text-red-700 mt-2",children:"Por favor, verifica tu conexi\xf3n a internet y recarga la p\xe1gina."})]})})})}):(0,r.jsx)(GestionTemas,{})}},2899:function(e,a,t){"use strict";t.d(a,{O:function(){return l},p:function(){return n}});var r=t(4756);let s="https://masterd.gepdigital.ai",l=(0,r.eI)(s,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE"),n=(0,r.eI)(s,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJzZXJ2aWNlX3JvbGUiLAogICAgImlzcyI6ICJzdXBhYmFzZS1kZW1vIiwKICAgICJpYXQiOiAxNjQxNzY5MjAwLAogICAgImV4cCI6IDE3OTk1MzU2MDAKfQ.DaYlNEoUrrEn2Ig7tqibS-PHK5vgusbcbo7X36XVt4Q")},1172:function(e,a,t){"use strict";t.d(a,{w_:function(){return GenIcon}});var r=t(2265),s={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},l=r.createContext&&r.createContext(s),__assign=function(){return(__assign=Object.assign||function(e){for(var a,t=1,r=arguments.length;t<r;t++)for(var s in a=arguments[t])Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s]);return e}).apply(this,arguments)},__rest=function(e,a){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>a.indexOf(r)&&(t[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>a.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(t[r[s]]=e[r[s]]);return t};function Tree2Element(e){return e&&e.map(function(e,a){return r.createElement(e.tag,__assign({key:a},e.attr),Tree2Element(e.child))})}function GenIcon(e){return function(a){return r.createElement(IconBase,__assign({attr:__assign({},e.attr)},a),Tree2Element(e.child))}}function IconBase(e){var elem=function(a){var t,s=e.attr,l=e.size,n=e.title,i=__rest(e,["attr","size","title"]),c=l||a.size||"1em";return a.className&&(t=a.className),e.className&&(t=(t?t+" ":"")+e.className),r.createElement("svg",__assign({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},a.attr,s,i,{className:t,style:__assign(__assign({color:e.color||a.color},a.style),e.style),height:c,width:c,xmlns:"http://www.w3.org/2000/svg"}),n&&r.createElement("title",null,n),e.children)};return void 0!==l?r.createElement(l.Consumer,null,function(e){return elem(e)}):elem(s)}}},function(e){e.O(0,[420,36,971,472,744],function(){return e(e.s=3952)}),_N_E=e.O()}]);